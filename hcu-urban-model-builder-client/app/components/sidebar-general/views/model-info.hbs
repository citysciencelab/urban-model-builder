<Ui::SaveIndicator
  @errors={{this.changeset.hasErrors}}
  @isSaving={{this.changeset.isSaving}}
/>
<div
  class="sidebar__header"
  {{did-insert this.initialize}}
  {{did-update this.initialize @modelVersion.model}}
  {{did-update this.onAutoSave this.changeset.isDirty}}
>
  {{#if this.changeset.hasErrors}}
    <BsAlert
      @type="danger"
      @dismissible={{false}}
      @visible={{this.changeset.hasErrors}}
    >
      {{t "messages.form_error"}}
    </BsAlert>
  {{/if}}

  <h4 class="mb-0">
    {{#if @modelVersion.canEdit}}
      <ContentEditable
        @value={{this.changeset.dataProxy.internalName}}
        @onChange={{fn (mut this.changeset.dataProxy.internalName)}}
        @placeholder={{t "components.model_info.name_placeholder"}}
      />
    {{else}}
      {{this.changeset.dataProxy.internalName}}
    {{/if}}
  </h4>
  {{#if this.changeset._errors.internalName}}
    <small class="text-danger">{{this.changeset._errors.internalName}}</small>
  {{/if}}
  <div class="sidebar__header__row">
    <Model::VersionSelect
      @model={{@modelVersion.model}}
      @currentVersion={{@modelVersion}}
    />
    {{! Badget: Latest }}
    {{#if @modelVersion.isLatest}}
      &nbsp;
      <span class="badge rounded-pill badge-success text-bg-light">
        {{t "components.share.latest"}}
      </span>
    {{/if}}
    {{! Badge: Public }}
    {{#if @modelVersion.isPublished}}
      &nbsp;
      <span class="badge rounded-pill badge-success text-bg-light">
        {{t "components.model_info.public"}}
      </span>
    {{/if}}
  </div>
</div>
<div class="sidebar__content">
  <div class="mb-3">
    {{#if @modelVersion.canEdit}}
      <label for="" class="form-label">{{t
          "models.model.attributes.description"
        }}</label>
      <ContentEditable
        @value={{this.changeset.dataProxy.description}}
        @onChange={{fn (mut this.changeset.dataProxy.description)}}
        @placeholder={{t "components.model_info.description_placeholder"}}
      />
    {{else}}
      {{this.changeset.dataProxy.description}}
    {{/if}}
  </div>

  {{#if @modelVersion.canEdit}}
    <div class="mb-3">
      <BsAccordion class="sidebar-accordion" as |acc|>
        <acc.item
          @value="urban-data-platforms"
          @title="{{t 'components.model_info.urban_data_platforms_title'}} ({{@modelVersion.ogcEndpoints.length}})"
        >
          <p class="text-muted mb-3">
            <small>{{t "components.model_info.urban_data_platforms_description"}}</small>
          </p>

            {{#each @modelVersion.ogcEndpoints as |endpoint index|}}
              <div class="card mb-2 border-0 bg-light">
                <div class="card-body p-3">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                      <div class="d-flex align-items-center mb-1">
                        <i class="fas fa-plug me-2 text-primary"></i>
                        <strong>{{endpoint.name}}</strong>
                        {{#if endpoint.isDefault}}
                          <span class="badge rounded-pill bg-primary ms-2">{{t "components.model_info.default_endpoint"}}</span>
                        {{/if}}
                      </div>
                      <div class="text-muted">
                        <small>
                          <i class="fas fa-link me-1"></i>
                          {{endpoint.baseUrl}}
                        </small>
                      </div>
                    </div>
                    {{#unless endpoint.isDefault}}
                      <BsButton
                        @type="outline-danger"
                        @size="sm"
                        @onClick={{fn this.removeOgcEndpoint index}}
                        title={{t "components.model_info.remove_endpoint"}}
                      >
                        <FaIcon @icon="trash" />
                      </BsButton>
                    {{/unless}}
                  </div>
                </div>
              </div>
            {{else}}
              <div class="text-center py-4">
                <i class="fas fa-database fa-2x text-muted mb-2"></i>
                <p class="text-muted">{{t "components.model_info.no_endpoints_configured"}}</p>
              </div>
            {{/each}}

            <div class="d-grid mt-3">
              <BsButton
                @type="primary"
                @onClick={{this.showAddEndpointModal}}
              >
                <i class="fas fa-plus me-2"></i>
                {{t "components.model_info.add_new_endpoint"}}
              </BsButton>
            </div>
        </acc.item>
      </BsAccordion>
    </div>
  {{/if}}
</div>

{{! Modal for adding new OGC endpoint }}
<BsModal
  @open={{this.showAddModal}}
  @onHide={{this.closeAddEndpointModal}}
  @size="lg"
  as |modal|
>
  <modal.header>
    <h5 class="modal-title">
      {{t "components.model_info.add_endpoint_modal_title"}}
    </h5>
  </modal.header>
  <modal.body>
    <div class="mb-4">
      <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        <strong>{{t "components.model_info.add_endpoint_modal_subtitle"}}</strong><br>
        <small>{{t "components.model_info.add_endpoint_modal_description"}}</small>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">
        <i class="fas fa-tag me-1"></i>
        {{t "components.model_info.endpoint_name_label"}}
      </label>
      <input
        type="text"
        class="form-control"
        value={{this.newEndpointName}}
        {{on "input" this.updateEndpointName}}
        placeholder={{t "components.model_info.endpoint_name_placeholder"}}
      />
      <div class="form-text">{{t "components.model_info.endpoint_name_help"}}</div>
    </div>

    <div class="mb-3">
      <label class="form-label">
        <i class="fas fa-link me-1"></i>
        {{t "components.model_info.endpoint_url_label"}}
      </label>
      <input
        type="url"
        class="form-control"
        value={{this.newEndpointUrl}}
        {{on "input" this.updateEndpointUrl}}
        placeholder={{t "components.model_info.endpoint_url_placeholder"}}
      />
      <div class="form-text">{{t "components.model_info.endpoint_url_help"}}</div>
    </div>
  </modal.body>
  <modal.footer>
    <Ui::ModalButtons
      @onCancel={{this.closeAddEndpointModal}}
      @onSubmit={{this.addOgcEndpoint}}
      @cancelText={{t "actions.cancel"}}
      @submitText={{t "components.model_info.add_endpoint_button"}}
      @submitDisabled={{or (not this.newEndpointName) (not this.newEndpointUrl)}}
    />
  </modal.footer>
</BsModal>